"use strict";(self.webpackChunkcheckingproject=self.webpackChunkcheckingproject||[]).push([[592],{6592:(e,t,a)=>{a.r(t),a.d(t,{default:()=>A});var l=a(9379),o=a(423),s=a(7305),n=a(4598),r=a(2250),i=a(5043),c=a(6833),d=a(3986),u=a(5394),p=a(432),m=a(2926),x=a(5200),f=a(579);const h=e=>{let{handleProfile:t,profilePhoto:a,changeProfilePhoto:l,handleFileUpload:o,PPLastUP:s,setPPLastUP:r,loading:c,message:d,removeProfilePhoto:p}=e;localStorage.getItem("userID").toString().toUpperCase();return(0,i.useEffect)((()=>{if(null!==l&&void 0!==l&&l.profilePhoto){(async e=>{var t;const a=await(0,m.I)({path:e});r(null===a||void 0===a||null===(t=a.url)||void 0===t?void 0:t.toString())})(l.profilePhoto)}}),[l]),(0,f.jsx)("section",{className:"fixed top-0 left-0 center w-full h-full z-50 bg-grey bg-opacity-15 inset-0",children:(0,f.jsxs)("div",{className:"bg-white max-w-md w-full max-h-80 h-full rounded-md center flex-col shadow-xl p-5 gap-1",children:[(0,f.jsx)("div",{className:"flex justify-end w-full h-[50px] ",onClick:t,children:(0,f.jsx)(u.LwM,{className:"text-[28px] text-dark_grey cursor-pointer"})}),(0,f.jsx)("div",{className:"center pb-2",children:(0,f.jsxs)("div",{className:"py-2 center flex-col max-w-[160px]",children:[(0,f.jsx)("input",{type:"file",id:"fileInput",name:"profilePhoto",accept:".jpg,.jpeg,.png",onChange:e=>o(e,"profilePhoto"),className:"hidden"}),(0,f.jsx)("div",{className:"h-[180px] w-[180px] border border-grey rounded-full center ",children:(0,f.jsxs)("div",{className:"h-[150px] w-[150px] rounded-full overflow-hidden flex items-center justify-center ".concat(c?"bg-lite_grey":""),children:[c&&(0,f.jsx)(x.TwU,{className:"absolute animate-spin-slow text-grey text-[40px]"}),(0,f.jsx)("img",{src:a||n,id:"previewImg",alt:"profile",className:"object-cover w-full h-full ".concat(c?"opacity-50":""),onError:e=>e.target.src=n})]})})]})}),(0,f.jsx)("div",{className:"flex justify-center"}),(0,f.jsxs)("div",{className:"flex justify-evenly items-center w-full pb-2",children:[(0,f.jsx)("button",{className:"border-2 border-primary bg-[#FFFCD7] rounded-md px-5 py-2",onClick:()=>document.getElementById("fileInput").click(),children:"Change"}),(0,f.jsx)("button",{className:"border-2 border-primary rounded-md px-5 py-2",onClick:()=>{p()},children:"Remove"})]})]})})};var g=a(1580),v=a(3305);var j=a(2759),y=a(8382),N=a(3646),w=a(3482);const P=["profilePhoto"],b=["__typename","createdAt","updatedAt"],k=(0,y.D)(),I=e=>{let{setIsOpen:t,profilePhoto:a,name:s,email:c,contactNo:m,getPPhotoString:x,setPersonalInfo:y,handleAfterUpload:I,loading:S,setLoading:F}=e;const A=(0,i.useRef)(null),C=localStorage.getItem("userID").toString().toUpperCase(),[_,D]=(0,i.useState)(""),[E,U]=(0,i.useState)(null),[L,q]=(0,i.useState)(!1),[O,T]=(0,i.useState)(""),z=async(e,t)=>{try{await(0,j.k)("profilePhoto",e,t)}catch(a){console.error("Error deleting file:",a)}},M=(0,i.useCallback)((async()=>{try{F(!0),T("Removing profile photo...");const e=x.split("/").pop();await z(e,C),D(""),y((e=>{let{profilePhoto:t}=e,a=(0,d.A)(e,P);return(0,l.A)((0,l.A)({},a),{},{profilePhoto:null})})),U(null),await R(null,C)}catch(e){}}),[x]),R=async(e,t)=>{!async function(){const a=await async function(e){let a=[],l=null;const o={and:[{empID:{eq:t||null}}]};do{const t=await k.graphql({query:e,variables:{filter:o,nextToken:l}}),s=t.data[Object.keys(t.data)[0]].items;a=[...a,...s],l=t.data[Object.keys(t.data)[0]].nextToken}while(l);return a}(N.it),o="public/".concat("profilePhoto","/",t,"/").concat(e);!async function(e){try{for(const t of e){const{__typename:e,createdAt:a,updatedAt:l}=t,o=(0,d.A)(t,b),s=(await k.graphql({query:w.CD,variables:{input:o}})).data.updateEmpPersonalInfo;let n=null===s||void 0===s?void 0:s.profilePhoto;const r=null===n||void 0===n?void 0:n.split("/").pop();"null"!==r?await I():"null"===r&&F(!1),T("null"===r?"Profile photo removed.":r?"Profile photo added.":"Change Profile File")}}catch(t){console.error("Error fetching employee data: ",t)}}(a.map((e=>(0,l.A)((0,l.A)({},e),{},{profilePhoto:o||null}))))}()},B=async(e,t)=>{try{F(!0),T("Uploading profile photo...");const a=e.target,o=a.files[0];if(!o)return;if(!["application/pdf","image/jpeg","image/png","image/jpg"].includes(o.type))return void alert("Upload must be a PDF file or an image (JPG, JPEG, PNG)");o&&q(!0),await z(o.name,C),await(async(e,t,a,o,s)=>{try{if(await(0,g.H)()){const n=(await(0,v.C)({path:"public/".concat(t,"/").concat(o,"/").concat(e.name),data:e}).result).path,r=(new Date).toISOString().split("T")[0];a("number"===typeof s?e=>{const a=(0,l.A)({},e);return a[t]=a[t]||[],a[t][s]=a[t][s]||[],a[t][s].find((e=>e.upload===n))||a[t][s].push({upload:n,date:r}),a}:"profilePhoto"===t||"inducBriefUp"===t||"uploadJobDetails"===t?e=>(0,l.A)((0,l.A)({},e),{},{[t]:n}):e=>(0,l.A)((0,l.A)({},e),{},{[t]:[...e[t]||[],{upload:n,date:r}]}))}}catch(n){}})(o,t,D,C),await R(o.name,C),a.value=""}catch(a){}};return(0,f.jsxs)("section",{children:[(0,f.jsxs)("div",{className:"center flex-col gap-2 py-2",children:[(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)("div",{className:"max-w-10 h-10 w-full rounded-full center relative overflow-hidden shadow-md shadow-[#00000033]",children:(0,f.jsx)("img",{className:"w-full object-cover h-full ",src:a||n,alt:"avatar not found",onError:e=>e.target.src=n})}),(0,f.jsx)("input",{type:"file",id:"fileInput",name:"profilePhoto",ref:A,accept:".jpg,.jpeg,.png",onChange:e=>B(e,"profilePhoto"),className:"hidden"}),(0,f.jsx)("p",{className:"absolute -right-2 bottom-0 h-5 w-5 rounded-full bg-[#D9D9D9] center",onClick:()=>{A.current.click()},children:(0,f.jsx)(u.iog,{className:"text-xs text-dark_grey cursor-pointer"})})]}),(0,f.jsx)(r.N_,{to:"/personalInformation",className:"text-xs text-dark_grey",onClick:()=>{t(!1)},children:"Personal Info Edit"}),(0,f.jsx)("div",{className:"h-1 w-full bg-[#AAAAAA]"})]}),(0,f.jsxs)("div",{className:"space-y-2 mb-3 px-4",children:[(0,f.jsxs)("div",{className:" space-y-1 text-[#4F4F4F] text-xs",children:[(0,f.jsx)("label",{htmlFor:"name",className:"font-medium ",children:"Name"}),(0,f.jsx)("div",{className:"border flex-1 rounded-md border-[#d4cfcf]  px-2 py-1 ",children:(0,f.jsx)("input",{id:"name",className:"outline-none w-full",type:"text",value:s,readOnly:!0})})]}),(0,f.jsxs)("div",{className:" space-y-1 text-[#4F4F4F] text-xs",children:[(0,f.jsx)("label",{htmlFor:"phoneNo",className:"font-medium ",children:"Phone Number"}),(0,f.jsx)("div",{className:"border rounded-md border-[#d4cfcf] text-[#4F4F4F] text-xs px-2 py-1 ",children:(0,f.jsx)("input",{id:"phoneNo",className:"outline-none w-full",type:"text",value:m,readOnly:!0})})]}),(0,f.jsxs)("div",{className:" space-y-1 text-[#4F4F4F] text-xs",children:[(0,f.jsx)("label",{htmlFor:"email",className:"font-medium ",children:"Email"}),(0,f.jsx)("div",{className:"border rounded-md border-[#d4cfcf] text-[#4F4F4F] text-xs px-2 py-1 ",children:(0,f.jsx)("input",{id:"email",className:"outline-none w-full",type:"text",value:c,readOnly:!0})})]}),(0,f.jsxs)("div",{className:"flex justify-between text-xs text-dark_grey font-semibold pt-3",children:[(0,f.jsx)(r.N_,{to:"/changePassword",className:"py-1 px-2 border-2 rounded-md border-primary ",children:"Change Password"}),(0,f.jsxs)(r.N_,{className:"flex items-center gap-1 py-1 px-2 bg-primary  rounded-md ",onClick:async()=>{try{await(0,p.C)(),localStorage.removeItem("userID"),localStorage.removeItem("userType"),window.location.href="/login"}catch(e){}},children:["Logout",(0,f.jsx)("span",{children:(0,f.jsx)(o.mXW,{className:"text-lg text-dark_grey"})})]})]})]}),L&&(0,f.jsx)(h,{handleProfile:()=>{q(!L)},profilePhoto:a,changeProfilePhoto:_,handleFileUpload:B,PPLastUP:E,setPPLastUP:U,loading:S,message:O,removeProfilePhoto:M})]})};var S=a(5318);const F=(0,y.D)(),A=()=>{const{unreadCount:e}=(0,S.q)();(0,i.useEffect)((()=>{}),[e]);const[t,a]=(0,i.useState)(!1),[l,d]=(0,i.useState)(""),[u,p]=(0,i.useState)(""),[x,h]=(0,i.useState)(""),[g,v]=(0,i.useState)(null),[j,y]=(0,i.useState)(!1),[w,P]=(0,i.useState)(null),[b,k]=(0,i.useState)({profilePhoto:"",name:"",email:"",contactNo:""}),[A,C]=(0,i.useState)(""),_=()=>{a((e=>!e))},D=(0,i.useRef)(null),E=e=>{D.current&&!D.current.contains(e.target)&&a(!1)};(0,i.useEffect)((()=>{const e=localStorage.getItem("userType");return d(e),document.addEventListener("mousedown",E),()=>{document.removeEventListener("mousedown",E)}}),[]),(0,i.useEffect)((()=>{const e=setInterval((()=>{const e=new Date,t=e.getDate(),a=e.getMonth()+1,l=e.getFullYear(),o="".concat(t,"/").concat(a,"/").concat(l);h(o);let s=e.getHours();const n=e.getMinutes(),r=e.getSeconds(),i=s>=12?"PM":"AM";s%=12,s=s||12;const c=n<10?"0"+n:n,d=r<10?"0"+r:r,u="".concat(s,":").concat(c,":").concat(d," ").concat(i),m="".concat(o," ").concat(u);p(m)}),1e3);return()=>clearInterval(e)}),[]);(0,i.useEffect)((()=>{const e=localStorage.getItem("userID");C(e)}),[]);return(0,i.useEffect)((()=>{A&&(async()=>{try{let e=[],t=null;do{const a=await F.graphql({query:N.it,variables:{nextToken:t}});e=[...e,...a.data.listEmpPersonalInfos.items],t=a.data.listEmpPersonalInfos.nextToken}while(t);const a=e;if(0===a.length)return;const l=a.find((e=>e.empID.toString().toLowerCase()===A.toString().toLowerCase()));if(l){let e="null"===(null===l||void 0===l?void 0:l.profilePhoto.split("/").pop())?"User-avatar.svg.png":null===l||void 0===l?void 0:l.profilePhoto;v(e),(async e=>{var t;const a=await(0,m.I)({path:e});P(!1),k({name:null===l||void 0===l?void 0:l.name,profilePhoto:null===a||void 0===a||null===(t=a.url)||void 0===t?void 0:t.toString(),email:null===l||void 0===l?void 0:l.email,contactNo:(null===l||void 0===l?void 0:l.contactNo)||""})})(e)}}catch(e){}})()}),[A,j]),(0,f.jsx)("nav",{className:"center bg-medium_white h-28 fixed top-0 w-full z-50 shadow-sm",children:(0,f.jsxs)("div",{className:"screen-size flex justify-between items-center gap-10 py-7 px-3",children:[(0,f.jsx)("section",{className:"flex-initial",children:(0,f.jsx)("div",{className:"max-w-[250px] w-full",children:(0,f.jsx)("img",{className:"w-full",src:s.A,alt:"not found"})})}),(0,f.jsxs)("section",{className:"flex-initial flex item-center gap-5 ",children:[(0,f.jsx)("div",{className:" my-auto",children:(0,f.jsxs)("p",{className:"relative",children:[(0,f.jsxs)(r.N_,{to:"/notifications",children:[" ",(0,f.jsx)(o.KB1,{className:"text-2xl"})]}),e>0&&(0,f.jsx)("span",{className:"absolute -top-[4px] right-[2px] rounded-full h-2 w-2 text-dark_grey bg-[#d04545] text-xs center",children:" "})]})}),(0,f.jsxs)("div",{className:"flex items-center gap-5 px-5",children:[(0,f.jsxs)("div",{className:"space-y-2 ",children:[(0,f.jsxs)("p",{className:"text-dark_grey text_size_5",children:[" ","Welcome ",b.name]}),(0,f.jsx)("article",{className:"flex gap-5 text_size_7 text-dark_grey",children:(0,f.jsx)("p",{children:u})})]}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)("div",{className:"w-12 h-12 rounded-full relative center overflow-hidden shadow-md shadow-[#00000033]",onClick:()=>_(),children:(0,f.jsx)("img",{className:"w-full object-center",src:(null===b||void 0===b?void 0:b.profilePhoto)||n,alt:"avatar not found",onError:e=>e.target.src=n})}),(0,f.jsx)("p",{className:"absolute -right-2 bottom-0 h-5 w-5 rounded-full bg-[#D9D9D9] center",onClick:()=>_(),children:(0,f.jsx)(c.i5t,{className:"text-xs text-dark_grey"})})]}),t&&(0,f.jsx)("div",{ref:D,className:"absolute top-12 -left-40 bg-white shadow-md  py-2 text-dark_grey text-[15px]  w-[250px]  flex flex-col",children:(0,f.jsx)(I,{setIsOpen:a,name:null===b||void 0===b?void 0:b.name,email:null===b||void 0===b?void 0:b.email,profilePhoto:null===b||void 0===b?void 0:b.profilePhoto,contactNo:null===b||void 0===b?void 0:b.contactNo,getPPhotoString:g,setPersonalInfo:k,handleAfterUpload:async()=>{y(!j)},loading:w,setLoading:P})})]})]})]})]})})}}}]);
//# sourceMappingURL=592.06f124ac.chunk.js.map